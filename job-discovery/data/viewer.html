<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pharma Job Matches</title>
<style>
:root {
  --bg: #0d1117;
  --bg-card: #161b22;
  --bg-hover: #1c2128;
  --border: #30363d;
  --text: #e6edf3;
  --text-dim: #8b949e;
  --text-muted: #6e7681;
  --accent: #58a6ff;
  --green: #3fb950;
  --yellow: #d29922;
  --red: #f85149;
  --purple: #a371f7;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.5;
  min-height: 100vh;
}
a { color: var(--accent); text-decoration: none; }
a:hover { text-decoration: underline; }

.header {
  background: var(--bg-card);
  border-bottom: 1px solid var(--border);
  padding: 16px 24px;
  position: sticky;
  top: 0;
  z-index: 100;
}
.header-inner {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  gap: 24px;
  flex-wrap: wrap;
}
.logo {
  font-size: 18px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}
.logo-dot { color: var(--green); }
.search-box {
  flex: 1;
  max-width: 400px;
  position: relative;
}
.search-box input {
  width: 100%;
  padding: 8px 12px 8px 36px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text);
  font-size: 14px;
}
.search-box input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(88,166,255,0.15);
}
.search-box input::placeholder { color: var(--text-muted); }
.search-box svg {
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-muted);
  width: 16px;
  height: 16px;
}
.header-stats {
  display: flex;
  gap: 16px;
  font-size: 13px;
  color: var(--text-dim);
}
.header-stats strong { color: var(--text); }

.filters {
  background: var(--bg-card);
  border-bottom: 1px solid var(--border);
  padding: 12px 24px;
}
.filters-inner {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  align-items: center;
}
.filter-group {
  display: flex;
  align-items: center;
  gap: 6px;
}
.filter-label {
  font-size: 12px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.filter-btn {
  padding: 4px 10px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 20px;
  color: var(--text-dim);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.15s;
}
.filter-btn:hover { border-color: var(--accent); color: var(--accent); }
.filter-btn.active {
  background: var(--accent);
  border-color: var(--accent);
  color: #fff;
}
select {
  padding: 4px 8px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--text);
  font-size: 12px;
  cursor: pointer;
}

.main {
  max-width: 1400px;
  margin: 0 auto;
  padding: 24px;
}

.job-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.job-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px 20px;
  transition: border-color 0.15s;
  cursor: pointer;
}
.job-card:hover { border-color: var(--accent); }
.job-card.expanded { border-color: var(--accent); }
.job-header {
  display: flex;
  align-items: flex-start;
  gap: 16px;
}
.job-main { flex: 1; min-width: 0; }
.job-title {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 4px;
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}
.job-title a { color: inherit; }
.job-title a:hover { color: var(--accent); }
.new-badge {
  background: rgba(63,185,80,0.15);
  color: var(--green);
  font-size: 10px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 10px;
  text-transform: uppercase;
}
.job-meta {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
  font-size: 13px;
  color: var(--text-dim);
}
.job-meta-item {
  display: flex;
  align-items: center;
  gap: 4px;
}
.job-meta-item svg { width: 14px; height: 14px; opacity: 0.7; }
.job-actions { display: flex; gap: 8px; flex-shrink: 0; }
.action-btn {
  padding: 6px 12px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text-dim);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.15s;
  display: flex;
  align-items: center;
  gap: 4px;
  text-decoration: none;
}
.action-btn:hover { border-color: var(--accent); color: var(--accent); text-decoration: none; }
.action-btn.primary { background: var(--accent); border-color: var(--accent); color: #fff; }
.action-btn.primary:hover { background: #4393e6; }

.source-badge { font-size: 11px; padding: 2px 8px; border-radius: 12px; font-weight: 500; }
.source-biospace { background: rgba(88,166,255,0.15); color: var(--accent); }
.source-greenhouse { background: rgba(63,185,80,0.15); color: var(--green); }
.source-workday { background: rgba(163,113,247,0.15); color: var(--purple); }
.source-attrax { background: rgba(210,153,34,0.15); color: var(--yellow); }
.source-talentbrew { background: rgba(248,81,73,0.15); color: var(--red); }

.bay-badge {
  background: rgba(210,153,34,0.15);
  color: var(--yellow);
  font-size: 10px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 10px;
  text-transform: uppercase;
}

.job-details {
  margin-top: 16px;
  padding-top: 16px;
  border-top: 1px solid var(--border);
  display: none;
}
.job-card.expanded .job-details { display: block; }
.job-description {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 16px;
  font-size: 13px;
  line-height: 1.7;
  color: var(--text-dim);
  max-height: 400px;
  overflow-y: auto;
  white-space: pre-wrap;
}
.job-detail-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 12px;
  margin-bottom: 12px;
}
.detail-item { background: var(--bg); padding: 10px 12px; border-radius: 6px; }
.detail-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); margin-bottom: 2px; }
.detail-value { font-size: 13px; color: var(--text); word-break: break-word; }

.empty-state { text-align: center; padding: 60px 20px; color: var(--text-muted); }
.empty-state h3 { font-size: 18px; color: var(--text-dim); margin-bottom: 8px; }

.error-state {
  text-align: center;
  padding: 80px 20px;
}
.error-state h2 { color: var(--text); margin-bottom: 12px; }
.error-state p { color: var(--text-dim); margin-bottom: 8px; font-size: 14px; }
.error-state code { background: var(--bg-card); padding: 4px 8px; border-radius: 4px; font-size: 13px; }

.kbd-hint {
  position: fixed;
  bottom: 12px;
  right: 12px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 6px 10px;
  font-size: 10px;
  color: var(--text-muted);
  display: flex;
  gap: 10px;
}
.kbd-hint kbd {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 0 4px;
  font-family: inherit;
}

@media (max-width: 768px) {
  .header-inner { gap: 12px; }
  .search-box { max-width: 100%; order: 3; flex-basis: 100%; }
  .job-header { flex-direction: column; }
  .job-actions { width: 100%; }
}
</style>
</head>
<body>

<div id="app"></div>

<!-- Data is loaded from data.js which defines window.JOBS_DATA -->
<script src="data.js"></script>
<script>
const icons = {
  company: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21h18M3 10h18M3 7l9-4 9 4M4 10v11M20 10v11M8 14v.01M8 17v.01M12 14v.01M12 17v.01M16 14v.01M16 17v.01"/></svg>',
  location: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>',
  calendar: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>',
  link: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"/></svg>'
};

let allJobs = [];
let state = { search: '', status: 'all', company: 'all', source: 'all', bayArea: 'all', sort: 'date_found-desc', expanded: null };

function init() {
  if (typeof window.JOBS_DATA !== 'undefined' && Array.isArray(window.JOBS_DATA)) {
    allJobs = window.JOBS_DATA;
    renderApp();
  } else {
    document.getElementById('app').innerHTML = `
      <div class="error-state">
        <h2>No data found</h2>
        <p>The file <code>data.js</code> is missing or empty.</p>
        <p>Run the job pipeline to generate matched jobs.</p>
      </div>
    `;
  }
}

function renderApp() {
  document.getElementById('app').innerHTML = `
    <header class="header">
      <div class="header-inner">
        <div class="logo"><span class="logo-dot">●</span> Pharma Jobs</div>
        <div class="search-box">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
          </svg>
          <input type="text" id="searchInput" placeholder="Search jobs..." autofocus>
        </div>
        <div class="header-stats" id="headerStats"></div>
      </div>
    </header>
    <div class="filters">
      <div class="filters-inner">
        <div class="filter-group">
          <span class="filter-label">Status</span>
          <button class="filter-btn active" data-filter="status" data-value="all">All</button>
          <button class="filter-btn" data-filter="status" data-value="new">New</button>
          <button class="filter-btn" data-filter="status" data-value="notified">Notified</button>
        </div>
        <div class="filter-group">
          <span class="filter-label">Location</span>
          <button class="filter-btn active" data-filter="bayArea" data-value="all">All</button>
          <button class="filter-btn" data-filter="bayArea" data-value="bay">Bay Area</button>
          <button class="filter-btn" data-filter="bayArea" data-value="other">Other</button>
        </div>
        <div class="filter-group">
          <span class="filter-label">Sort</span>
          <select id="sortSelect">
            <option value="date_found-desc">Newest first</option>
            <option value="date_found-asc">Oldest first</option>
            <option value="company-asc">Company A-Z</option>
            <option value="title-asc">Title A-Z</option>
          </select>
        </div>
        <div class="filter-group" id="companyFilters"></div>
        <div class="filter-group" id="sourceFilters"></div>
      </div>
    </div>
    <main class="main"><div class="job-list" id="jobList"></div></main>
    <div class="kbd-hint"><span><kbd>/</kbd> Search</span><span><kbd>Esc</kbd> Clear</span></div>
  `;
  initFilters();
  attachEvents();
  render();
}

function initFilters() {
  const companies = [...new Set(allJobs.map(j => j.company).filter(Boolean))].sort();
  if (companies.length > 1 && companies.length <= 12) {
    let h = '<span class="filter-label">Company</span><button class="filter-btn active" data-filter="company" data-value="all">All</button>';
    companies.forEach(c => h += `<button class="filter-btn" data-filter="company" data-value="${esc(c)}">${esc(c)}</button>`);
    document.getElementById('companyFilters').innerHTML = h;
  }
  const sources = [...new Set(allJobs.map(j => (j.source||'').split(':')[0]).filter(Boolean))].sort();
  if (sources.length > 1) {
    let h = '<span class="filter-label">Source</span><button class="filter-btn active" data-filter="source" data-value="all">All</button>';
    sources.forEach(s => h += `<button class="filter-btn" data-filter="source" data-value="${esc(s)}">${esc(s)}</button>`);
    document.getElementById('sourceFilters').innerHTML = h;
  }
}

function attachEvents() {
  document.getElementById('searchInput').addEventListener('input', e => { state.search = e.target.value; render(); });
  document.getElementById('sortSelect').addEventListener('change', e => { state.sort = e.target.value; render(); });
  document.addEventListener('click', e => {
    const btn = e.target.closest('.filter-btn');
    if (btn?.dataset.filter) {
      state[btn.dataset.filter] = btn.dataset.value;
      btn.parentElement.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      render();
      return;
    }
    const card = e.target.closest('.job-card');
    if (card && !e.target.closest('a')) {
      const idx = parseInt(card.dataset.idx);
      state.expanded = state.expanded === idx ? null : idx;
      render();
    }
  });
  document.addEventListener('keydown', e => {
    if (e.key === '/' && document.activeElement.tagName !== 'INPUT') { e.preventDefault(); document.getElementById('searchInput').focus(); }
    if (e.key === 'Escape') { document.getElementById('searchInput').value = ''; state.search = ''; state.expanded = null; render(); }
  });
}

function getFiltered() {
  let jobs = [...allJobs];
  if (state.search) {
    const terms = state.search.toLowerCase().split(/\s+/);
    jobs = jobs.filter(j => {
      const txt = [j.title, j.company, j.location, j.description||''].join(' ').toLowerCase();
      return terms.every(t => txt.includes(t));
    });
  }
  if (state.status === 'new') jobs = jobs.filter(j => !j.notified);
  else if (state.status === 'notified') jobs = jobs.filter(j => j.notified);
  if (state.bayArea === 'bay') jobs = jobs.filter(j => j.is_bay_area === true);
  else if (state.bayArea === 'other') jobs = jobs.filter(j => j.is_bay_area !== true);
  if (state.company !== 'all') jobs = jobs.filter(j => j.company === state.company);
  if (state.source !== 'all') jobs = jobs.filter(j => (j.source||'').split(':')[0] === state.source);
  const [col, dir] = state.sort.split('-');
  jobs.sort((a, b) => {
    let va = (a[col] || a.discovered_at || '');
    let vb = (b[col] || b.discovered_at || '');
    if (typeof va === 'string') va = va.toLowerCase();
    if (typeof vb === 'string') vb = vb.toLowerCase();
    return (va < vb ? -1 : va > vb ? 1 : 0) * (dir === 'asc' ? 1 : -1);
  });
  return jobs;
}

function render() {
  const jobs = getFiltered();
  const newCount = allJobs.filter(j => !j.notified).length;
  const bayCount = allJobs.filter(j => j.is_bay_area === true).length;
  document.getElementById('headerStats').innerHTML = `<span><strong>${jobs.length}</strong> of ${allJobs.length}</span><span><strong>${newCount}</strong> new</span><span><strong>${bayCount}</strong> Bay Area</span>`;
  
  if (!jobs.length) {
    document.getElementById('jobList').innerHTML = '<div class="empty-state"><h3>No jobs found</h3><p>Try adjusting your search or filters</p></div>';
    return;
  }
  
  document.getElementById('jobList').innerHTML = jobs.map((j, i) => {
    const isNew = !j.notified, isExp = state.expanded === i;
    const src = (j.source||'').split(':')[0].toLowerCase();
    const posted = fmt(j.date_posted || j.posted_date), found = fmt(j.date_found || j.discovered_at);
    return `
      <div class="job-card${isExp?' expanded':''}" data-idx="${i}">
        <div class="job-header">
          <div class="job-main">
            <div class="job-title">
              <a href="${esc(j.url)}" target="_blank" onclick="event.stopPropagation()">${esc(j.title)}</a>
              ${isNew?'<span class="new-badge">New</span>':''}
            </div>
            <div class="job-meta">
              <span class="job-meta-item">${icons.company} ${esc(j.company)}</span>
              ${j.location?`<span class="job-meta-item">${icons.location} ${esc(j.location)}</span>`:''}
              ${j.is_bay_area?'<span class="bay-badge">Bay Area</span>':''}
              ${posted?`<span class="job-meta-item">${icons.calendar} ${posted}</span>`:''}
              <span class="source-badge source-${src}">${esc(j.source)}</span>
            </div>
          </div>
          <div class="job-actions">
            <a href="${esc(j.url)}" target="_blank" class="action-btn primary" onclick="event.stopPropagation()">${icons.link} View</a>
          </div>
        </div>
        <div class="job-details">
          <div class="job-detail-grid">
            <div class="detail-item"><div class="detail-label">Found</div><div class="detail-value">${found||'Unknown'}</div></div>
            <div class="detail-item"><div class="detail-label">Department</div><div class="detail-value">${esc(j.department)||'—'}</div></div>
            <div class="detail-item"><div class="detail-label">Status</div><div class="detail-value">${j.notified?'Notified':'New'}</div></div>
          </div>
          ${j.description?`<div class="job-description">${esc(j.description)}</div>`:'<div class="job-description" style="opacity:0.5">No description</div>'}
        </div>
      </div>`;
  }).join('');
}

function esc(s) { return s ? String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;') : ''; }
function fmt(d) { if (!d) return ''; try { const x = new Date(d); return isNaN(x) ? d : x.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}); } catch { return d; } }

init();
</script>
</body>
</html>
